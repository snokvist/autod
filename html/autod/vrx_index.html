<!doctype html>
<meta charset="utf-8">
<title>autod — VRX console</title>
<link rel="stylesheet" href="./assets/console-theme.css">
<link rel="stylesheet" href="./assets/vrx/vrx.css">

<header>
  <div>
    <div class="title">autod — VRX console</div>
    <div class="sub" id="subtitle">loading caps…</div>
  </div>
  <div class="row" style="justify-content:flex-end">
    <button id="refreshCaps">Refresh /caps</button>
  </div>
</header>

<main>
  <section class="card" id="capsCard" style="display:none">
    <h2>Device & runtime</h2>
    <div class="body grid">
      <div class="kv"><div class="mut">Device</div><div id="dev_device">—</div></div>
      <div class="kv"><div class="mut">Role</div><div id="dev_role">—</div></div>
      <div class="kv"><div class="mut">Version</div><div id="dev_version">—</div></div>
      <div class="kv"><div class="mut">Interfaces</div><div id="dev_if">—</div></div>
      <div class="kv"><div class="mut">Uptime</div><div id="dev_uptime">—</div></div>
      <div class="kv"><div class="mut">Loadavg</div><div id="dev_load">—</div></div>
      <div class="kv"><div class="mut">Capabilities</div><div class="caps" id="dev_caps">—</div></div>
      <div class="kv"><div class="mut">SSE</div><div class="sse" id="dev_sse">—</div></div>
      <div class="row" id="deviceRuntimeActions" style="display:none">
        <button id="pixelpilotMiniRkRebootBtn">Reboot device</button>
        <button id="pixelpilotMiniRkShutdownBtn">Shutdown device</button>
      </div>
    </div>
  </section>

  <section class="card" id="nodesCard" style="display:none">
    <h2>Nodes</h2>
    <div class="body grid">
      <div class="nodes-toolbar">
        <button id="nodesScanBtn">POST /nodes (scan)</button>
        <div class="spacer"></div>
        <div class="nodes-stats" id="nodesStats">—</div>
      </div>
      <div class="progress" aria-label="Scan progress"><div id="nodesProgress"></div></div>
      <div id="nodesNotice" class="mut">—</div>
      <div class="nodes-grid" id="nodesGrid"></div>
      <datalist id="nodeResolutionPresets">
        <option value="1920x1080"></option>
        <option value="1600x900"></option>
        <option value="1280x720"></option>
        <option value="960x720"></option>
        <option value="960x540"></option>
        <option value="720x540"></option>
        <option value="640x480"></option>
        <option value="480x360"></option>
      </datalist>
    </div>
  </section>

  <section class="card" id="syncCard" style="display:none">
    <h2>Sync slots</h2>
    <div class="body grid sync-body">
      <div class="row">
        <button id="syncRefreshBtn" type="button">Refresh status</button>
        <button id="syncApplyMovesBtn" type="button" disabled>Apply pending moves</button>
        <button id="syncClearMovesBtn" type="button" disabled>Clear pending</button>
        <div class="spacer"></div>
        <div class="mut" id="syncStatus">cap missing</div>
      </div>
      <div class="sync-pending" id="syncPendingWrap" style="display:none">
        <div class="mut">Pending moves</div>
        <ul id="syncPendingList"></ul>
      </div>
      <div class="sync-grid" id="syncSlotsGrid"></div>
      <div>
        <div class="mut">Waiting / unassigned slaves</div>
        <div id="syncWaitingList" class="sync-waiting">—</div>
      </div>
    </div>
  </section>

  <section class="card" id="pixelpilotCard" style="display:none">
    <h2>Pixelpilot</h2>
    <div class="body grid">
      <div class="cap-toolbar">
        <div id="pixelpilotCmds" class="row"></div>
        <button id="pixelpilotRefreshBtn">Refresh values</button>
        <div class="spacer"></div>
        <div class="cap-stats" id="pixelpilotStats">—</div>
      </div>
      <div class="cap-grid" id="pixelpilotGrid"></div>
      <div>
        <div class="mut">Last request:</div>
        <pre class="inline" id="pixelpilotReqPreview">{}</pre>
        <div class="mut">Last response:</div>
        <textarea id="pixelpilotResp" readonly></textarea>
      </div>
    </div>
  </section>

  <section class="card" id="joystickCard" style="display:none">
    <h2>Joystick (joystick2crfs)</h2>
    <div class="body grid">
      <div class="row joy-row">
        <div class="status-indicator" id="joystickStatus">Idle</div>
        <div class="mut" id="joystickLastUpdate">Last update: —</div>
        <div class="mut" id="joystickEndpoint">Endpoint: —</div>
        <div class="spacer"></div>
        <button id="joystickReconnectBtn" type="button">Reconnect</button>
      </div>
      <div class="joy-grid" id="joystickSseGrid"></div>
      <div class="mut">Streaming scaled channels and raw values from the joystick SSE feed.</div>
      <div class="cap-toolbar">
        <div id="joystickCmds" class="row"></div>
        <button id="joystickRefreshBtn" type="button">Refresh values</button>
        <div class="spacer"></div>
        <div class="cap-stats" id="joystickConfigStats">—</div>
      </div>
      <div class="cap-grid" id="joystickConfigGrid"></div>
      <div class="mut">Configuration changes persist to /etc/joystick2crfs.conf. Reload to apply without restarting.</div>
    </div>
  </section>

  <section class="card" id="pixelpilotMiniRkCard" style="display:none">
    <h2>Pixelpilot Mini RK</h2>
    <div class="body grid">
      <div class="cap-toolbar">
        <div class="row" id="pixelpilotMiniRkActions">
          <button id="pixelpilotMiniRkToggleOsdBtn">Toggle OSD</button>
          <button id="pixelpilotMiniRkToggleRecordingBtn">Toggle Recording</button>
          <button id="pixelpilotMiniRkRestartServiceBtn">Restart pixelpilot_mini_rk</button>
          <button id="pixelpilotMiniRkStopServiceBtn">Stop pixelpilot_mini_rk</button>
          <button id="pixelpilotMiniRkStartServiceBtn">Start pixelpilot_mini_rk</button>
        </div>
        <div class="row mini-rk-gamma-row">
          <label for="pixelpilotMiniRkGammaSelect">Gamma preset</label>
          <select id="pixelpilotMiniRkGammaSelect" disabled>
            <option>Loading presets…</option>
          </select>
          <button id="pixelpilotMiniRkApplyGammaBtn" type="button" disabled>Apply preset</button>
          <button id="pixelpilotMiniRkReloadGammaBtn" type="button">Reload presets</button>
          <div class="mut" id="pixelpilotMiniRkGammaNotice">Loading presets…</div>
        </div>
        <div class="spacer"></div>
        <div class="mini-status">
          <div class="status-indicator" id="pixelpilotMiniRkStatus" aria-live="polite">Idle</div>
        </div>
      </div>
    </div>
  </section>

  <section class="card" id="dvrCard" style="display:none">
    <h2>DVR recordings</h2>
    <div class="body grid dvr-body">
      <div class="row">
        <button id="dvrRefreshBtn">Refresh list</button>
        <button id="dvrDeleteAllBtn">Delete all</button>
        <div class="spacer"></div>
        <div class="mut" id="dvrStatus">—</div>
      </div>
      <div class="dvr-scroll">
        <div id="dvrMessage" class="dvr-message" style="display:none"></div>
        <div id="dvrEmptyState" class="dvr-empty" style="display:none">No recordings found.</div>
        <div id="dvrList" class="dvr-list"></div>
      </div>
    </div>
  </section>

  <section class="card" id="udpRelayCard" style="display:none">
    <h2>UDP relay</h2>
    <div class="body grid">
      <div class="cap-toolbar">
        <div id="udpRelayCmds" class="row"></div>
        <button id="udpRelayRefreshBtn">Refresh values</button>
        <button id="udpRelayReloadEmbedBtn">Reload relay UI</button>
        <div class="spacer"></div>
        <div class="cap-stats" id="udpRelayStats">—</div>
      </div>

      <section id="card-udp-relay" class="card">
      <div id="udpRelayEmbedContainer" class="embed-wrap">
        <div class="embed-note mut">Trying to load http://localhost:9000/…</div>
      </div>
      </section>

      <div class="cap-grid" id="udpRelayGrid"></div>
    </div>
  </section>

  <section class="card" id="udpSenderCard" style="display:none">
    <h2>UDP sender</h2>
    <div class="body grid">
      <div class="row">
        <label>host <input id="udpSenderHost" value="192.168.2.20"></label>
        <label>port <input id="udpSenderPort" type="number" min="1" max="65535" value="5005"></label>
        <label>image host <input id="udpSenderImageHost" value="192.168.0.1"></label>
        <label>image format
          <select id="udpSenderImageFormat">
            <option value="jpg">JPEG</option>
          </select>
        </label>
        <label>click size
          <select id="udpSenderClickSize">
            <option value="25">25% × 25%</option>
            <option value="30">30% × 30%</option>
            <option value="35">35% × 35%</option>
            <option value="40">40% × 40%</option>
            <option value="45">45% × 45%</option>
            <option value="50">50% × 50%</option>
            <option value="55">55% × 55%</option>
            <option value="60">60% × 60%</option>
            <option value="65">65% × 65%</option>
            <option value="70">70% × 70%</option>
            <option value="75">75% × 75%</option>
            <option value="80">80% × 80%</option>
            <option value="85">85% × 85%</option>
            <option value="90">90% × 90%</option>
            <option value="95">95% × 95%</option>
            <option value="100">100% × 100%</option>
            <option value="150">150% × 150%</option>
            <option value="200">200% × 200%</option>
            <option value="300">300% × 300%</option>
          </select>
        </label>
      </div>
      <div class="udp-viewport">
        <div id="udpSenderScreen" class="udp-screen" role="presentation" aria-label="Draw zoom ROI">
          <div id="udpSenderImageLayer" class="udp-screen-image" aria-hidden="true"></div>
          <div id="udpSenderRoi" class="udp-roi"></div>
          <div id="udpSenderHint" class="udp-screen-hint">Drag to set zoom ROI</div>
        </div>
        <div class="udp-roi-meta">
          <div><strong>Size</strong> <span class="udp-value" data-udp-value="xsize">50</span>% × <span class="udp-value" data-udp-value="ysize">50</span>%</div>
          <div><strong>Center</strong> X <span class="udp-value" data-udp-value="xpos">50</span>% · Y <span class="udp-value" data-udp-value="ypos">50</span>%</div>
        </div>
      </div>
      <div class="row">
        <label>ttl (ms) <input id="udpSenderTtl" type="number" min="0" value="10000"></label>
        <button id="udpSenderSendBtn">Send</button>
        <div class="spacer"></div>
      </div>
      <div>
        <div class="mut">curl preview:</div>
        <pre class="inline" id="udpSenderCurlPreview"></pre>
      </div>
      <div>
        <div class="mut">Request body:</div>
        <pre class="inline" id="udpSenderBodyPreview"></pre>
      </div>
      <div>
        <div class="mut">Last response:</div>
        <textarea id="udpSenderResponse" readonly></textarea>
      </div>
    </div>
  </section>

  <section class="card" id="linkCard" style="display:none">
    <h2>Link</h2>
    <div class="body grid">
      <div class="cap-toolbar">
        <div id="linkCmds" class="row"></div>
        <div class="spacer"></div>
        <div class="cap-stats" id="linkStats">—</div>
      </div>
      <div class="cap-grid" id="linkGrid"></div>
      <div>
        <div class="mut">Last request:</div>
        <pre class="inline" id="linkReqPreview">{}</pre>
        <div class="mut">Last response:</div>
        <textarea id="linkResp" readonly></textarea>
      </div>
    </div>
  </section>
  <section class="card" id="execCard">
    <h2>/exec — raw runner</h2>
    <div class="body">
      <div class="row">
        <label>path <input id="exec_path" value="/sys/pixelpilot/help"></label>
        <label>args (space-separated) <input id="exec_args" placeholder=''></label>
        <button id="exec_btn">POST /exec</button>
      </div>
      <div class="mut">Body preview:</div>
      <pre class="inline" id="exec_body_preview">{}</pre>
      <div class="mut">Response:</div>
      <textarea id="exec_out" readonly></textarea>
    </div>
  </section>
  <section class="card" id="remoteExecCard" style="display:none">
    <h2>Remote /exec — raw runner</h2>
    <div class="body">
      <div class="row">
        <label>target <input id="remoteExec_targetInput" value="http://192.168.2.203:55667/exec" placeholder="http://host:port/exec"></label>
        <div class="spacer"></div>
      </div>
      <div class="row">
        <label>path <input id="remoteExec_path" value="/sys/help"></label>
        <label>args (space-separated; use key=value for setters) <input id="remoteExec_args" placeholder='bitrate=8192'></label>
        <button id="remoteExec_btn">POST remote /exec</button>
      </div>
      <div class="mut" id="remoteExec_target">Target: —</div>
      <div class="mut">Body preview:</div>
      <pre class="inline" id="remoteExec_body_preview">{}</pre>
      <div class="mut">Response:</div>
      <textarea id="remoteExec_out" readonly></textarea>
    </div>
  </section>
</main>

<script type="module" src="./assets/vrx/main.js"></script>
