; Example master configuration. Copy to /etc/autod/autod.conf on master nodes.

[server]
port=55667
bind=0.0.0.0
enable_scan = 1

[scan]
# Optionally probe additional CIDR blocks beyond detected interfaces.
# Repeat extra_subnet lines as needed, e.g.:
# extra_subnet = 10.10.10.0/24
; single host example
extra_subnet = 192.168.0.1/32


[exec]
interpreter=/usr/local/share/autod/vrx/exec-handler.sh
timeout_ms=5000
max_output_bytes=16384

[caps]
device=radxa-3e
role=vrx
version=1.0.0
caps=vrx,joystick2crsf,pixelpilot_mini_rk,dvr,link,exec,udp_relay,device,nodes,udp_sender
include_net_info=1

[announce]
sse=pixelpilot_mini_rk@http://IP:8082/stats
sse=joystick2crsf@http://IP:8070/sse

[ui]
serve_ui=1
ui_path=/usr/local/share/autod/vrx/vrx_index.html
ui_public=1

[sync]
# role can be "master" to accept slave registrations or "slave" to follow a master.
# Leave empty to disable sync behaviour.
role=master
# When acting as a slave, set master_url to the master's sync identifier.
# The daemon resolves sync:// IDs through the discovery cache.
# master_url=sync://radxa-3e-master/sync/register
# Seconds between slave registrations/heartbeats.
register_interval_s=10
# Allow POST /sync/bind to update the slave master_url at runtime.
allow_bind=1
# Optional timeout (seconds) before stale slots are released. 0 = keep forever.
slot_retention_s=0
# Optional explicit identifier. Defaults to hostname if omitted.
id=radxa-3e-master

[sync.slot1]
# Up to 10 slots are available. Slots are assigned to slaves in discovery order.
# Each exec line must be valid JSON accepted by POST /exec.
name=primary
# prefer_id pins this slot to a specific slave ID when it registers. Placeholders
# are moved to other slots (or waiting) the moment the preferred ID checks in.
prefer_id=alpha-node
exec={"path":"/sys/video/set","args":["outgoing_server=udp://192.168.2.20:5700"]}
exec={"path":"/sys/video/set","args":["outgoing_enabled=true"]}

[sync.slot2]
# Additional commands run sequentially for the assigned slave during sync.
prefer_id=beta-node
exec={"path":"/sys/video/set","args":["outgoing_server=udp://192.168.2.20:5701"]}
exec={"path":"/sys/video/set","args":["outgoing_enabled=true"]}

[sync.slot3]
prefer_id=gamma-node
exec={"path":"/sys/video/set","args":["outgoing_server=udp://192.168.2.20:5702"]}
exec={"path":"/sys/video/set","args":["outgoing_enabled=true"]}

[sync.slot4]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}
[sync.slot5]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}
[sync.slot6]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}
[sync.slot7]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}
[sync.slot8]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}
[sync.slot9]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}
[sync.slot10]
exec={"path":"/sys/video/set","args":["outgoing_enabled=false"]}

[startup]
# Each exec line should be a JSON body accepted by POST /exec.
# Commands run sequentially once the HTTP server and background threads are ready.
; exec={"path":"/usr/local/bin/autod-ready","args":["--online"]}
exec={"path":"/sys/pixelpilot_mini_rk/gamma","args":["milos1"]}
